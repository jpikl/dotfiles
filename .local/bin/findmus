#!/usr/bin/env bash

set -euo pipefail

source "$BASH_LIB_DIR/core.sh"

help() {
  cat <<-EOT
		Find files in music directory.

		Usage:
		  $(self) [options] [--] <name>

		Options:
		  -f  Search for files only.
		  -d  Search for directories only.
		  -h  Display this help.

		Name:
		  Name to find.
	EOT
}

main() {
  local files_only=false
  local dirs_only=false
  local opt

  while getopts ":fdh" opt; do
    case "$opt" in
      f) files_only=true ;;
      d) dirs_only=true ;;
      h) help; exit ;;
      *) die_invalid_opt "$opt" ;;
    esac
  done

  shift $((OPTIND - 1))

  [[ $# -eq 0 ]] && die_missing_arg
  [[ $MUSIC_DIR ]] || die_no_var MUSIC_DIR

  local exprs=(-iname "*$1*")

  [[ $files_only = true ]] && exprs+=(-type f)
  [[ $dirs_only = true ]] && exprs+=(-type d)

  find "$MUSIC_DIR" "${exprs[@]}" -printf '%P\n'
}

main "$@"
