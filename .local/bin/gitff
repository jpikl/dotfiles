#!/usr/bin/env bash

set -euo pipefail

source "$BASH_LIB_DIR/core.sh"

help() {
  cat <<-EOT
		Fast-forward git branches.

		Usage:
		  $(self) [options] [--] [branch]...

		Options:
		  -a  Fast-forward all local branches.
		  -h  Print this help.

		Branch:
		  One or more branches to fast-forward.
	EOT
}

main() {
  local all=false
  local opt

  while getopts ":ah" opt; do
    case "$opt" in
      a) all=true ;;
      h) help; exit ;;
      *) die_invalid_opt "$opt" ;;
    esac
  done

  shift $((OPTIND - 1))

  local branches=("$@")
  [[ $all = true ]] && mapfile -t branches < <(gitlsb -l)

  local current_branch
  current_branch=$(gitlsb -c)

  local branch
  for branch in "${branches[@]}"; do
    if [[ $branch != "$current_branch" ]]; then
      git fetch origin "$branch:$branch"
    fi
  done
}

main "$@"
