#!/usr/bin/env bash

set -euo pipefail

source "$BASH_LIB_DIR/core.sh"

help() {
  cat <<-EOT
		Open file or URL in the user's preferred application.

		Usage:
		  $(self) [<options>] <item>...

		Args:
		  <item>...  Files or URLs to open.

		Options:
		  -s  Skip opening errors.
		  -h  Print this help.
	EOT
}

main() {
  local skip_errors=false
  local opt

  while getopts ":sh" opt; do
    case "$opt" in
      s) skip_errors=true ;;
      h) help; exit ;;
      *) die_invalid_opt "$opt" ;;
    esac
  done

  shift $((OPTIND - 1))
  [[ $# -eq 0 ]] && die_missing_arg

  local cmd
  if [[ -x "$(command -v xdg-open)" ]]; then
    cmd=xdg-open
  elif [[ ${MSYSTEM-} =~ ^MINGW(32|64)$ && -x "$(command -v start)" ]]; then
    cmd=start
  else
    die "unable to detect native open command"
  fi

  local item
  for item; do
    echo "Opening '$item'"
    "$cmd" "$item" || [[ $skip_errors = true ]] || die
  done
}

main "$@"
